import{u as K,j as e,L as W,b as C,T as E,E as X,d as Y,e as a,f as L}from"./index.C8FWxaAt.js";import{u as Z,c as ee,b as i,L as T}from"./vendor.CrEiiG9O.js";import{E as se}from"./eye-off.Dx18PKBZ.js";function ae(){const t="#487a43",R="#3e6c3b",j="#3c6538",M=Z(),g=new URLSearchParams(M.search),n=g.get("mail"),p=g.get("isVerified"),$=g.get("redirectTo")??"/profile",_=ee(),{logout:A,setUser:N,setToken:O,setMagasins:P,setDefaultMagasin:U,setUid:V,setIsVerified:q,setExpiresIn:B,setRefreshToken:D,setRefreshExpiresIn:F,setUserContext:S}=K(),[I,c]=i.useState(!1),[h,b]=i.useState(""),[y,H]=i.useState(""),[w,J]=i.useState(!1),[x,z]=i.useState({identifier:"",password:""});i.useEffect(()=>{n&&b(n)},[n]),i.useEffect(()=>{window.scrollTo({top:0,behavior:"smooth"})},[]);const G=()=>{const r={identifier:h?"":"L'email ou le numéro de téléphone est obligatoire.",password:y?"":"Le mot de passe est obligatoire."};return z(r),Object.values(r).every(s=>!s)},Q=async r=>{if(r.preventDefault(),!G()){a.dismiss(),a.error("Connexion échouée : champs manquants ou invalides.",{position:"top-center",autoClose:4e3});return}c(!0);try{const s=await L.login({username:h,password:y});console.log("response",s);const o=s?.access_token||s?.accessToken||s?.token||s?.data?.access_token,l=s?.refresh_token||s?.refreshToken||s?.data?.refresh_token,d=s?.expires_in||s?.data?.expires_in||null,u=s?.refresh_expires_in||s?.data?.refresh_expires_in||null,f=s?.uid||s?.user_id||s?.data?.uid||null,m=s?.is_verified??s?.data?.is_verified??(p?p==="true":!1),v=s?.magasins||[],k=s?.default_magasin||null;if(!o)throw new Error("Jeton d’accès manquant.");if(s?.user_info?.role==="main_user"){a.warning("Veuillez utiliser votre compte client.",{position:"top-center",autoClose:3e3}),A(),c(!1);return}localStorage.setItem("accessToken",o),localStorage.setItem("access_token",o),localStorage.setItem("token",o),l&&(localStorage.setItem("refresh_token",l),localStorage.setItem("refreshToken",l)),d&&localStorage.setItem("expires_in",d),u&&localStorage.setItem("refresh_expires_in",u),f&&localStorage.setItem("uid",f),localStorage.setItem("is_verified",String(!!m)),localStorage.setItem("magasins",JSON.stringify(v)),localStorage.setItem("default_magasin",JSON.stringify(k)),O(o),P(v),U(k),V(f),q(String(!!m)),B(d||null),D(l||null),F(u||null),s?.user_info?(localStorage.setItem("user",JSON.stringify(s.user_info)),N(s.user_info),S({user:s.user_info,token:o,uid:f,is_verified:String(!!m),expiresIn:d||null,refreshToken:l||null,refreshExpiresIn:u||null,magasins:v,default_magasin:k})):(N(null),S({user:null,token:o,uid:f,is_verified:String(!!m),expiresIn:d||null,refreshToken:l||null,refreshExpiresIn:u||null})),a.dismiss(),a.success("Connexion réussie ✅",{position:"top-center",autoClose:2500}),m?_($,{replace:!0}):_("/verification-code",{replace:!0})}catch(s){console.error(s),a.dismiss();const o=s?.response?.data?.error||s?.response?.data?.message||"Identifiants invalides ou erreur serveur.";a.error(o,{position:"top-center",autoClose:5e3})}finally{c(!1)}};return i.useEffect(()=>{(async()=>{if(n&&p)try{c(!0),(await L.verifiedCompte(n))?.status==="success"&&b(n)}catch{a.error("Votre compte n'est pas encore validé.",{position:"top-center",autoClose:5e3})}finally{c(!1)}})()},[]),e.jsx(W,{children:e.jsx("div",{className:"w-full flex items-start justify-center px-1 py bg-gray-50",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col items-center mb-6 select-none",children:[e.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center shadow-sm",style:{backgroundColor:t},"aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-7 h-7 text-white",fill:"currentColor",children:e.jsx("path",{d:"M12 3l9 8h-3v8h-5v-5H11v5H6v-8H3l9-8z"})})}),e.jsx("h1",{className:"mt-3 text-2xl font-extrabold",style:{color:t},children:"Connexion"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 text-center",children:"Accédez à votre espace sécurisé"})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 border border-[#E0E0E0] dark:border-gray-700 rounded-lg shadow-md",children:e.jsxs("form",{onSubmit:Q,className:"space-y-5",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"identifier",className:"block mb-2 text-sm font-medium",children:"Adresse email ou téléphone"}),e.jsx(E,{id:"identifier",type:"text",value:h,onChange:r=>b(r.target.value),placeholder:"ex: email@domaine.com ou +221 77 000 00 00",required:!0,className:"w-full focus:ring-2",theme:{field:{input:{base:`block w-full border disabled:cursor-not-allowed disabled:opacity-50
                           bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                           focus:ring-2 focus:ring-[${j}] focus:border-[${t}]
                           placeholder:text-gray-400`,colors:{gray:`border-gray-300 dark:border-gray-600
                             focus:border-[${t}] dark:focus:border-[${t}]`}}}}}),x.identifier&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:x.identifier})]}),e.jsxs("div",{children:[e.jsx(C,{htmlFor:"password",className:"block mb-2 text-sm font-medium",children:"Mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(E,{id:"password",type:w?"text":"password",value:y,onChange:r=>H(r.target.value),placeholder:"••••••••",required:!0,className:"w-full pr-10",theme:{field:{input:{base:`block w-full border disabled:cursor-not-allowed disabled:opacity-50
                             bg-white dark:bg-gray-700 text-gray-900 dark:text-white
                             focus:ring-2 focus:ring-[${j}] focus:border-[${t}]`,colors:{gray:`border-gray-300 dark:border-gray-600
                               focus:border-[${t}] dark:focus:border-[${t}]`}}}}}),e.jsx("button",{type:"button",onClick:()=>J(r=>!r),className:"absolute inset-y-0 right-0 flex items-center pr-3","aria-label":w?"Masquer le mot de passe":"Afficher le mot de passe",children:w?e.jsx(se,{className:"h-5 w-5 text-gray-400 dark:text-gray-300"}):e.jsx(X,{className:"h-5 w-5 text-gray-400 dark:text-gray-300"})})]}),x.password&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:x.password})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{}),e.jsx(T,{to:"/forgot-password",className:"text-sm hover:underline",style:{color:t},children:"Mot de passe oublié ?"})]}),e.jsx("button",{type:"submit",className:"w-full flex items-center justify-center text-white font-medium py-2.5 px-4 rounded-md focus:outline-none focus:ring-2 transition disabled:opacity-60",style:{backgroundColor:t},onMouseEnter:r=>r.currentTarget.style.backgroundColor=R,onMouseLeave:r=>r.currentTarget.style.backgroundColor=t,disabled:I,children:I?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"mr-2 h-4 w-4 animate-spin"}),e.jsx("span",{children:"Connexion…"})]}):"Se connecter"}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Pas de compte ?",e.jsx(T,{to:"/signup",className:"ml-1 underline",style:{color:t},children:"S’inscrire"})]})})]})})]})})})}export{ae as default};
