import{u as f,h as b,j as e,S as g,L as v,P as w}from"./index.esEeeJLm.js";import{b as r,L as c}from"./vendor.CrEiiG9O.js";const n=a=>a?new Date(a).toLocaleDateString("fr-FR"):"—",d=(a,l="XOF")=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:l}).format(Number(a||0)),x=({status:a})=>{const t={paid:"bg-green-100 text-green-700",posted:"bg-blue-100 text-blue-700",not_paid:"bg-red-100 text-red-700",partial:"bg-yellow-100 text-yellow-700",overdue:"bg-red-100 text-red-700",draft:"bg-gray-100 text-gray-700"}[a]||"bg-gray-100 text-gray-700";return e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs ${t}`,children:a})};function F(){const{user:a}=f(),l=a?.partner_id,[t,j]=r.useState(null),[u,o]=r.useState(!0);r.useEffect(()=>{window.scrollTo(0,0)},[]),r.useEffect(()=>{let s=!0;return(async()=>{try{if(!l){o(!1);return}const y=await b.dashboard(l);s&&j(y)}finally{s&&o(!1)}})(),()=>{s=!1}},[l]);const N=r.useMemo(()=>t?.last_invoices?.[0]?.currency||"XOF",[t]),i=t?.active_contracts||[],m=t?.properties||[],h=t?.last_invoices||[],p=t?.next_due_schedules||[];return e.jsxs(e.Fragment,{children:[e.jsx(g,{title:"Mon espace locatif",description:"Synthèse contrats, factures, locaux."}),e.jsx(v,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"about-page-wrapper w-full",children:[e.jsx("div",{className:"title-area w-full",children:e.jsx(w,{title:"Tableau de bord",breadcrumb:[{name:"Accueil",path:"/"},{name:"Profil",path:"/profile"}]})}),e.jsx("div",{className:"aboutus-wrapper w-full",children:e.jsx("div",{className:"container-x mx-auto p-4 space-y-6",children:u?e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 w-48 bg-gray-100 animate-pulse rounded"}),e.jsx("div",{className:"h-24 w-full bg-gray-100 animate-pulse rounded"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-3",children:"Synthèse"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Contrats actifs"}),e.jsx("div",{className:"text-xl font-semibold",children:i.length})]}),e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Tous contrats"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.all_contracts?.length||0})]}),e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Impayés (nb)"}),e.jsx("div",{className:"text-xl font-semibold",children:t?.unpaid_count||0})]}),e.jsxs("div",{className:"p-3 border rounded",children:[e.jsx("div",{className:"text-xs text-gray-500",children:"Impayés (montant)"}),e.jsx("div",{className:"text-xl font-semibold",children:d(t?.unpaid_total||0,N)})]})]})]}),e.jsxs("section",{className:"bg-white border rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Contrats actifs"}),e.jsx(c,{to:"/contrats",className:"text-sm underline",children:"Voir tous"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Code"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Local"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Période"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Loyer mensuel"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Factures"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Impayés (nb)"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Impayés (montant)"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Action"})]})}),e.jsxs("tbody",{children:[i.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:s.name}),e.jsx("td",{className:"py-2 px-3",children:s.property_name||"—"}),e.jsxs("td",{className:"py-2 px-3",children:[n(s.start_date)," → ",n(s.end_date)]}),e.jsx("td",{className:"py-2 px-3",children:d(s.monthly_rent,"XOF")}),e.jsx("td",{className:"py-2 px-3",children:s.invoice_count||0}),e.jsx("td",{className:"py-2 px-3",children:s.unpaid_invoice_count||0}),e.jsx("td",{className:"py-2 px-3",children:d(s.total_unpaid||0,"XOF")}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsx(c,{className:"px-3 py-1 bg-yellow-400 rounded",to:`/contrats/${s.id}`,children:"Détails"})})]},s.id)),i.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"py-3 px-3",colSpan:8,children:"Aucun contrat actif."})})]})]})})]}),e.jsxs("section",{className:"bg-white border rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Dernières factures"}),e.jsx(c,{to:"/factures",className:"text-sm underline",children:"Voir toutes"})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Code"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Émise"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Échéance"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Montant"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Statut"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Action"})]})}),e.jsxs("tbody",{children:[h.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:s.code||s.name||`#${s.id}`}),e.jsx("td",{className:"py-2 px-3",children:n(s.issue_date)}),e.jsx("td",{className:"py-2 px-3",children:n(s.due_date)}),e.jsx("td",{className:"py-2 px-3",children:d(s.amount_total,s.currency||"XOF")}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(x,{status:s.status})}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsx(c,{className:"underline",to:`/factures/${s.id}`,children:"Détails"})})]},s.id)),h.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"py-3 px-3",colSpan:6,children:"Aucune facture récente."})})]})]})})]}),e.jsxs("section",{className:"bg-white border rounded p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-semibold",children:"Mes locaux"}),e.jsx(c,{to:"/locaux",className:"text-sm underline",children:"Voir tous"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3",children:[m.map(s=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsx("div",{className:"font-semibold",children:s.name}),e.jsx("div",{className:"text-xs text-gray-500",children:s.building_name||"—"}),e.jsxs("div",{className:"mt-2 text-sm",children:["Statut: ",e.jsx(x,{status:s.status})]}),e.jsx("div",{className:"mt-2",children:e.jsx(c,{to:`/locaux/${s.id}`,className:"text-sm underline",children:"Détails"})})]},s.id)),m.length===0&&e.jsx("div",{className:"text-sm text-gray-500",children:"Aucun local actif."})]})]}),e.jsxs("section",{className:"bg-white border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Prochaines échéances"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Contrat"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Échéance"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Montant"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Statut"})]})}),e.jsxs("tbody",{children:[p.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:s.contract_name||s.contract_id}),e.jsx("td",{className:"py-2 px-3",children:n(s.due_date)}),e.jsx("td",{className:"py-2 px-3",children:d(s.amount,"XOF")}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(x,{status:s.state})})]},s.id)),p.length===0&&e.jsx("tr",{children:e.jsx("td",{className:"py-3 px-3",colSpan:4,children:"Aucune échéance à venir."})})]})]})})]})]})})})]})})]})}export{F as default};
