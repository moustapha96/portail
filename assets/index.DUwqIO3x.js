import{j as s,L as O,d as E,f as j,e as f}from"./index.CYLRWMMU.js";import{c as R,u as V,b as a,L as D}from"./vendor.CrEiiG9O.js";function A(){const o="#487a43",v="#3e6c3b",b=R();V();const[m,L]=a.useState(""),[c,p]=a.useState(["","","",""]),[g,i]=a.useState(""),[h,y]=a.useState(!1),l=a.useRef([]);a.useEffect(()=>{l.current?.[0]?.focus()},[]);const d=(e,t)=>{t>=0&&t<4&&l.current[t]?.focus()},N=(e,t)=>{if(t.length>1&&(t=t.charAt(0)),t!==""&&!/^\d$/.test(t))return;const r=[...c];r[e]=t,p(r),i(""),t!==""&&e<3&&d(e,e+1),r.join("").length===4&&r.every(n=>n!=="")&&x(r.join(""))},w=(e,t)=>{t.key==="Backspace"&&c[e]===""&&e>0&&d(e,e-1),t.key==="ArrowLeft"&&d(e,e-1),t.key==="ArrowRight"&&d(e,e+1)},k=e=>{e.preventDefault();const t=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,4);if(!t)return;const r=t.padEnd(4," ").split("").slice(0,4);if(p(r),t.length===4)x(t);else{const n=r.findIndex(u=>!/^\d$/.test(u));d(0,n===-1?3:n)}},x=async e=>{const t=e||c.join("");if(t.length!==4){i("Veuillez entrer les 4 chiffres du code OTP");return}if(!h){y(!0),i("");try{const r={email:m,code:t},n=await j.verifierCodeOTP(r),u=typeof n?.message=="string"?n.message:"";u.toLowerCase().includes("valide")?(f.success("Vérification réussie !",{position:"top-center",autoClose:3e3}),b(`/login?mail=${encodeURIComponent(m)}`,{replace:!0})):(i(u||"Code OTP invalide"),f.error(u||"Code OTP invalide",{position:"top-center"}),p(["","","",""]),l.current[0]?.focus())}catch(r){const n=typeof r?.response?.data=="string"&&r.response.data||typeof r?.response?.data?.message=="string"&&r.response.data.message||r?.message||"Échec de la vérification du code OTP";i(n),f.error(n,{position:"top-center"})}finally{y(!1)}}},C=async()=>{try{await j.resendOtp(m),p(["","","",""]),l.current[0]?.focus(),f.info("Un nouveau code a été envoyé.",{position:"top-center",autoClose:3e3})}catch{f.error("Échec de l'envoi du code. Veuillez réessayer.",{position:"top-center"})}};return s.jsx(O,{children:s.jsx("div",{className:"w-full flex items-start justify-center px-4 py bg-gray-50",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs("div",{className:"flex flex-col items-center mb-6 select-none",children:[s.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center shadow-sm",style:{backgroundColor:o},"aria-hidden":!0,children:s.jsx("svg",{viewBox:"0 0 24 24",className:"w-7 h-7 text-white",fill:"currentColor",children:s.jsx("path",{d:"M12 3l9 8h-3v8h-5v-5H11v5H6v-8H3l9-8z"})})}),s.jsx("h1",{className:"mt-3 text-2xl font-extrabold",style:{color:o},children:"Vérification OTP"}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1 text-center",children:["Saisissez le code à 4 chiffres envoyé à ",s.jsx("span",{className:"font-medium",children:m})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 border border-[#E0E0E0] dark:border-gray-700 rounded-lg shadow-md",children:[s.jsx("div",{className:"mt-6 flex justify-center gap-3",onPaste:k,children:[0,1,2,3].map(e=>s.jsx("input",{ref:t=>l.current[e]=t,id:`otp-${e}`,type:"text",inputMode:"numeric",maxLength:1,className:"w-14 h-14 text-center text-2xl font-bold border border-gray-300 dark:border-gray-600 rounded-md\r\n                             focus:outline-none focus:ring-2 focus:ring-[${BRAND_RING}] focus:border-[${BRAND}]\r\n                             dark:bg-gray-700 dark:text-white",value:c[e],onChange:t=>N(e,t.target.value),onKeyDown:t=>w(e,t)},e))}),g&&s.jsx("p",{className:"text-sm text-red-500 mt-4 text-center",children:g}),s.jsx("div",{className:"mt-6",children:s.jsx("button",{type:"button",onClick:()=>x(),disabled:h||c.join("").length!==4,className:"w-full flex items-center justify-center text-white font-medium py-2.5 px-4 rounded-md focus:outline-none focus:ring-2 transition disabled:opacity-60",style:{backgroundColor:o},onMouseEnter:e=>e.currentTarget.style.backgroundColor=v,onMouseLeave:e=>e.currentTarget.style.backgroundColor=o,children:h?s.jsxs(s.Fragment,{children:[s.jsx(E,{className:"mr-2 h-4 w-4 animate-spin"}),s.jsx("span",{children:"Vérification en cours…"})]}):"Vérifier le code OTP"})}),s.jsx("div",{className:"flex justify-center mt-6",children:s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Vous n'avez pas reçu de code ?",s.jsx("button",{type:"button",className:"ml-2 underline",style:{color:o},onClick:C,children:"Renvoyer"})]})}),s.jsx("div",{className:"flex justify-center mt-4",children:s.jsx(D,{to:"/login",className:"text-sm underline",style:{color:o},children:"Se connecter"})})]})]})})})}export{A as default};
