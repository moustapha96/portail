import{k as f,j as e,S as v,L as _,P as g}from"./index.C8FWxaAt.js";import{h as w,b as n,L as p}from"./vendor.CrEiiG9O.js";const l=(r,t="XOF")=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:t}).format(Number(r||0)),i=r=>r?new Date(r).toLocaleDateString("fr-FR"):"—",L={green:"bg-emerald-100 text-emerald-700",red:"bg-red-100 text-red-700",yellow:"bg-amber-100 text-amber-700",blue:"bg-blue-100 text-blue-700",gray:"bg-gray-100 text-gray-700"},S={rented:"green",available:"gray",maintenance:"yellow",reserved:"blue",active:"green",expired:"gray",terminated:"gray",overdue:"red",paid:"green",not_paid:"red",partial:"yellow",posted:"blue"},E={rented:"Loué",available:"Disponible",maintenance:"Maintenance",reserved:"Réservé",active:"Actif",expired:"Expiré",terminated:"Résilié",overdue:"En retard",paid:"Payée",not_paid:"Impayée",partial:"Partielle",posted:"Comptabilisée"};function o({status:r}){const t=(r||"").toLowerCase(),d=S[t]||"gray",u=E[t]||r||"—";return e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${L[d]}`,children:u})}const A={monthly:"Mensuel",quarterly:"Trimestriel",yearly:"Annuel"};function I(){const{id:r}=w(),[t,d]=n.useState(null),[u,y]=n.useState(!0);n.useEffect(()=>{window.scrollTo(0,0)},[]),n.useEffect(()=>{let a=!0;return(async()=>{try{const m=await f.byId(r);a&&d(m||null)}catch{a&&d(null)}finally{a&&y(!1)}})(),()=>{a=!1}},[r]);const c=n.useMemo(()=>t?.currency||t?.current_contract?.currency||"XOF",[t]),h=n.useMemo(()=>{const a=Number(t?.current_contract?.total_unpaid??0),m=Number(t?.total_unpaid_invoices??0),b=a||m||0,N=Number(t?.current_contract?.unpaid_invoice_count??0);return{unpaid:b,cnt:N}},[t]),j=t?.surface_area??t?.area;return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:`Local ${t?.name||""}`}),e.jsx(_,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"about-page-wrapper w-full",children:[e.jsx("div",{className:"title-area w-full",children:e.jsx(g,{title:`Local ${t?.name||""}`,breadcrumb:[{name:"Accueil",path:"/"},{name:"Locaux",path:"/locaux"}]})}),e.jsx("div",{className:"aboutus-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto p-4 space-y-6",children:[e.jsx("section",{className:"bg-white border rounded p-4",children:u?e.jsx("div",{className:"text-sm text-gray-500 animate-pulse",children:"Chargement…"}):t?e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsx(s,{label:"Immeuble",value:t?.building_name||"—"}),e.jsx(s,{label:"Type",value:t?.property_type||"—"}),e.jsx(s,{label:"Surface",value:j?`${j} m²`:"—"}),e.jsx(s,{label:"Étage",value:t?.floor??"—"}),e.jsx(s,{label:"Loyer mensuel",value:l(t?.monthly_rent,c)}),e.jsx(s,{label:"Statut",value:e.jsx(o,{status:t?.status})}),!!t?.address&&e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("div",{className:"text-gray-500",children:"Adresse / Emplacement"}),e.jsx("div",{className:"font-medium",children:t.address})]}),!!t?.description&&e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("div",{className:"text-gray-500",children:"Description"}),e.jsx("div",{className:"font-medium",children:t.description})]}),!!t?.note&&e.jsxs("div",{className:"md:col-span-3",children:[e.jsx("div",{className:"text-gray-500",children:"Note"}),e.jsx("div",{className:"font-medium",children:t.note})]}),e.jsxs("div",{className:"md:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-3 mt-2",children:[e.jsx(x,{label:"Contrats (total)",value:t?.contract_count??0}),e.jsx(x,{label:"Impayés (nb)",value:h.cnt}),e.jsx(x,{label:"Impayés (montant)",value:l(h.unpaid,c)}),e.jsx(x,{label:"Actif",value:t?.active?"Oui":"Non"})]})]}):e.jsx("div",{className:"text-sm text-gray-600",children:"Local introuvable."})}),!!t?.current_contract&&e.jsxs("section",{className:"bg-white border rounded p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-semibold",children:"Contrat actif"}),e.jsx(p,{to:`/contrats/${t.current_contract.id}`,className:"text-sm underline",children:"Voir le contrat"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsx(s,{label:"Code",value:t.current_contract.name}),e.jsx(s,{label:"Période",value:`${i(t.current_contract.start_date)} → ${i(t.current_contract.end_date)}`}),e.jsx(s,{label:"Statut",value:e.jsx(o,{status:t.current_contract.state})}),e.jsx(s,{label:"Loyer contrat",value:l(t.current_contract.monthly_rent,c)}),e.jsx(s,{label:"Fréquence",value:A[(t.current_contract.payment_frequency||"").toLowerCase()]||t.current_contract.payment_frequency||"—"}),e.jsx(s,{label:"Jour de paiement",value:t.current_contract.payment_day??"—"}),e.jsx(s,{label:"Caution",value:l(t.current_contract.deposit_amount,c)}),e.jsx(s,{label:"Caution payée",value:t.current_contract.deposit_paid?"Oui":"Non"}),e.jsx(s,{label:"Impayés (nb)",value:t.current_contract.unpaid_invoice_count||0}),e.jsx(s,{label:"Impayés (montant)",value:l(t.current_contract.total_unpaid||0,c)})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Échéancier"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Échéance"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Montant"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Statut"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Facture"})]})}),e.jsxs("tbody",{children:[(t.current_contract.payment_schedule||[]).map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:i(a.due_date)}),e.jsx("td",{className:"py-2 px-3",children:l(a.amount,c)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(o,{status:a.state})}),e.jsx("td",{className:"py-2 px-3",children:a.invoice_id?e.jsx(p,{className:"underline",to:`/factures/${a.invoice_id}`,children:"Voir facture"}):"—"})]},a.id)),(!t.current_contract.payment_schedule||t.current_contract.payment_schedule.length===0)&&e.jsx("tr",{children:e.jsx("td",{className:"py-3 px-3",colSpan:4,children:"Aucun échéancier."})})]})]})})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h4",{className:"font-semibold mb-2",children:"Factures liées"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Code"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Émise"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Échéance"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Montant"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Statut"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Action"})]})}),e.jsxs("tbody",{children:[(t.current_contract.invoices||[]).map(a=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:a.code||a.name||`#${a.id}`}),e.jsx("td",{className:"py-2 px-3",children:i(a.issue_date)}),e.jsx("td",{className:"py-2 px-3",children:i(a.due_date)}),e.jsx("td",{className:"py-2 px-3",children:l(a.amount_total,a.currency||c)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(o,{status:a.status})}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsx(p,{to:`/factures/${a.id}`,className:"underline",children:"Détails"})})]},a.id)),(!t.current_contract.invoices||t.current_contract.invoices.length===0)&&e.jsx("tr",{children:e.jsx("td",{className:"py-3 px-3",colSpan:6,children:"Aucune facture."})})]})]})})]})]})]})})]})})]})}function s({label:r,value:t}){return e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:r}),e.jsx("div",{className:"font-medium",children:t??"—"})]})}function x({label:r,value:t}){return e.jsxs("div",{className:"p-4 rounded border bg-white",children:[e.jsx("div",{className:"text-xs text-gray-500",children:r}),e.jsx("div",{className:"text-xl font-semibold",children:t})]})}export{I as default};
