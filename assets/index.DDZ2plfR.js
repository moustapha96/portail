import{j as s,L as R,d as P,f as y,e as d}from"./index.iLE0PaT3.js";import{c as E,u as V,b as u,L as D}from"./vendor.CrEiiG9O.js";function B(){const n="#487a43",j="#3e6c3b",v=E(),b=V(),f=new URLSearchParams(b.search).get("email"),[c,m]=u.useState(["","","",""]),[x,a]=u.useState(""),[p,g]=u.useState(!1),i=u.useRef([]);u.useEffect(()=>{i.current?.[0]?.focus()},[]);const l=(e,t)=>{t>=0&&t<4&&i.current[t]?.focus()},N=(e,t)=>{if(t.length>1&&(t=t.charAt(0)),t!==""&&!/^\d$/.test(t))return;const r=[...c];r[e]=t,m(r),a(""),t!==""&&e<3&&l(e,e+1),r.join("").length===4&&r.every(o=>o!=="")&&h(r.join(""))},w=(e,t)=>{t.key==="Backspace"&&c[e]===""&&e>0&&l(e,e-1),t.key==="ArrowLeft"&&l(e,e-1),t.key==="ArrowRight"&&l(e,e+1)},k=e=>{e.preventDefault();const t=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,4);if(!t)return;const r=t.padEnd(4," ").split("").slice(0,4);if(m(r),t.length===4)h(t);else{const o=r.findIndex(O=>!/^\d$/.test(O));l(0,o===-1?3:o)}},h=async e=>{const t=e||c.join("");if(t.length!==4){a("Veuillez entrer les 4 chiffres du code OTP");return}if(!p){g(!0),a("");try{const r={email:f,code:t};console.log(r);const o=await y.verifierCodeOTP(r);console.log(o),o&&o.success?(d.success("Vérification réussie !",{position:"top-center",autoClose:3e3}),v(`/login?mail=${encodeURIComponent(f)}`,{replace:!0})):(a("Code OTP invalide ou expiré."),d.error("Code OTP invalide ou expiré.",{position:"top-center"}),m(["","","",""]),i.current[0]?.focus())}catch(r){console.error(r);const o=typeof r?.response?.data=="string"&&r.response.data||typeof r?.response?.data?.message=="string"&&r.response.data.message||r?.message||"Échec de la vérification du code OTP";a(o),d.error(o,{position:"top-center"})}finally{g(!1)}}},C=async()=>{a("");try{await y.resendOtp(f),m(["","","",""]),i.current[0]?.focus(),d.info("Un nouveau code a été envoyé.",{position:"top-center",autoClose:3e3})}catch{d.error("Échec de l'envoi du code. Veuillez réessayer.",{position:"top-center"})}};return s.jsx(R,{children:s.jsx("div",{className:"w-full flex items-start justify-center px-4 py bg-gray-50",children:s.jsxs("div",{className:"w-full max-w-md",children:[s.jsxs("div",{className:"flex flex-col items-center mb-6 select-none",children:[s.jsx("div",{className:"w-14 h-14 rounded-full flex items-center justify-center shadow-sm",style:{backgroundColor:n},"aria-hidden":!0,children:s.jsx("svg",{viewBox:"0 0 24 24",className:"w-7 h-7 text-white",fill:"currentColor",children:s.jsx("path",{d:"M12 3l9 8h-3v8h-5v-5H11v5H6v-8H3l9-8z"})})}),s.jsx("h1",{className:"mt-3 text-2xl font-extrabold",style:{color:n},children:"Vérification OTP"}),s.jsxs("p",{className:"text-sm text-gray-600 mt-1 text-center",children:["Saisissez le code à 4 chiffres envoyé à ",s.jsx("span",{className:"font-medium",children:f})]})]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 border border-[#E0E0E0] dark:border-gray-700 rounded-lg shadow-md",children:[s.jsx("div",{className:"mt-6 flex justify-center gap-3",onPaste:k,children:[0,1,2,3].map(e=>s.jsx("input",{ref:t=>i.current[e]=t,id:`otp-${e}`,type:"text",inputMode:"numeric",maxLength:1,className:"w-14 h-14 text-center text-2xl font-bold border border-gray-300 dark:border-gray-600 rounded-md\r\n                             focus:outline-none focus:ring-2 focus:ring-[${BRAND_RING}] focus:border-[${BRAND}]\r\n                             dark:bg-gray-700 dark:text-white",value:c[e],onChange:t=>N(e,t.target.value),onKeyDown:t=>w(e,t)},e))}),x&&s.jsx("p",{className:"text-sm text-red-500 mt-4 text-center",children:x}),s.jsx("div",{className:"mt-6",children:s.jsx("button",{type:"button",onClick:()=>h(),disabled:p||c.join("").length!==4,className:"w-full flex items-center justify-center text-white font-medium py-2.5 px-4 rounded-md focus:outline-none focus:ring-2 transition disabled:opacity-60",style:{backgroundColor:n},onMouseEnter:e=>e.currentTarget.style.backgroundColor=j,onMouseLeave:e=>e.currentTarget.style.backgroundColor=n,children:p?s.jsxs(s.Fragment,{children:[s.jsx(P,{className:"mr-2 h-4 w-4 animate-spin"}),s.jsx("span",{children:"Vérification en cours…"})]}):"Vérifier le code OTP"})}),s.jsx("div",{className:"flex justify-center mt-6",children:s.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Vous n'avez pas reçu de code ?",s.jsx("button",{type:"button",className:"ml-2 underline",style:{color:n},onClick:C,children:"Renvoyer"})]})}),s.jsx("div",{className:"flex justify-center mt-4",children:s.jsx(D,{to:"/login",className:"text-sm underline",style:{color:n},children:"Se connecter"})})]})]})})})}export{B as default};
