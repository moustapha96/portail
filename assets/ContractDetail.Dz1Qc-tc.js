import{i as b,j as e,S as v,L as g,P as f}from"./index.eWEbYf7N.js";import{h as _,b as r,L as y}from"./vendor.CrEiiG9O.js";const i=a=>a?new Date(a).toLocaleDateString("fr-FR"):"—",m=(a,l="XOF")=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:l}).format(Number(a||0)),w={monthly:"Mensuel",quarterly:"Trimestriel",yearly:"Annuel"},C={active:{label:"Actif",cls:"bg-emerald-100 text-emerald-700"},expired:{label:"Expiré",cls:"bg-red-100 text-red-700"},draft:{label:"Brouillon",cls:"bg-gray-100 text-gray-700"},cancelled:{label:"Annulé",cls:"bg-zinc-100 text-zinc-700"}},E={not_paid:{label:"Impayée",cls:"bg-red-100 text-red-700"},paid:{label:"Payée",cls:"bg-emerald-100 text-emerald-700"},partial:{label:"Partiellement payée",cls:"bg-amber-100 text-amber-700"},cancelled:{label:"Annulée",cls:"bg-gray-100 text-gray-700"},overdue:{label:"En retard",cls:"bg-red-100 text-red-700"},posted:{label:"Comptabilisée",cls:"bg-blue-100 text-blue-700"}},S={overdue:{label:"En retard",cls:"bg-red-100 text-red-700"},due_soon:{label:"À échéance",cls:"bg-amber-100 text-amber-700"},paid:{label:"Payée",cls:"bg-emerald-100 text-emerald-700"},pending:{label:"En attente",cls:"bg-gray-100 text-gray-700"}};function p({type:a="neutral",state:l}){const x=(l||"").toLowerCase(),o=(a==="invoice"?E:a==="schedule"?S:C)?.[x]||{label:l||"—",cls:"bg-gray-100 text-gray-700"};return e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${o.cls}`,children:o.label})}function F(){const{id:a}=_(),[l,x]=r.useState(null),[j,o]=r.useState(!0);r.useEffect(()=>{window.scrollTo(0,0)},[]),r.useEffect(()=>{let t=!0;return(async()=>{try{const c=await b.byId(a);t&&x(c)}catch(c){console.error(c),t&&x(null)}finally{t&&o(!1)}})(),()=>{t=!1}},[a]);const s=l||{},d=r.useMemo(()=>Array.isArray(s?.invoices)&&s.invoices[0]?.currency||"XOF",[s?.invoices]),h=r.useMemo(()=>{const t=s?.invoices||[],c=t.filter(u=>{const n=(u.status||"").toLowerCase();return n==="not_paid"||n==="partial"||n==="overdue"}),N=c.reduce((u,n)=>u+Number(n.amount_residual??n.amount_total??0),0);return{count:t.length,unpaidCount:c.length,totalUnpaid:N}},[s?.invoices]);return e.jsxs(e.Fragment,{children:[e.jsx(v,{title:`Contrat ${s?.name||""}`}),e.jsx(g,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"about-page-wrapper w-full",children:[e.jsx("div",{className:"title-area w-full",children:e.jsx(f,{title:`Contrat ${s?.name||""}`,breadcrumb:[{name:"Accueil",path:"/"},{name:"Contrats",path:"/contrats"}]})}),e.jsx("div",{className:"aboutus-wrapper w-full",children:e.jsxs("div",{className:"container-x mx-auto p-4 space-y-6",children:[e.jsx("section",{className:"bg-white border rounded p-4",children:j?e.jsx("div",{className:"animate-pulse text-sm text-gray-500",children:"Chargement…"}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Locataire"}),e.jsx("div",{className:"font-medium",children:s.tenant_name||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Local"}),e.jsx("div",{className:"font-medium",children:s.property_name||"—"})]}),e.jsxs("div",{className:"flex items-center justify-between md:block",children:[e.jsx("div",{className:"text-gray-500",children:"Statut du contrat"}),e.jsx("div",{className:"font-medium",children:e.jsx(p,{state:s.state})})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Période"}),e.jsxs("div",{className:"font-medium",children:[i(s.start_date)," → ",i(s.end_date)]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Durée"}),e.jsxs("div",{className:"font-medium",children:[s.duration_months||0," mois"]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Fréquence de paiement"}),e.jsx("div",{className:"font-medium",children:w[(s.payment_frequency||"").toLowerCase()]||s.payment_frequency||"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Jour de paiement"}),e.jsx("div",{className:"font-medium",children:typeof s.payment_day=="number"?`Chaque ${s.payment_day} du mois`:"—"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Loyer mensuel"}),e.jsx("div",{className:"font-medium",children:m(s.monthly_rent,d)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Caution"}),e.jsxs("div",{className:"font-medium",children:[m(s.deposit_amount,d)," ",e.jsx("span",{className:"ml-2 text-xs",children:s.deposit_paid?e.jsx("span",{className:"text-emerald-600",children:"• versée"}):e.jsx("span",{className:"text-red-600",children:"• non versée"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Factures (total)"}),e.jsx("div",{className:"font-medium",children:h.count})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Factures impayées"}),e.jsx("div",{className:"font-medium",children:h.unpaidCount})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-gray-500",children:"Total impayé"}),e.jsx("div",{className:"font-medium",children:m(h.totalUnpaid,d)})]})]})}),e.jsxs("section",{className:"bg-white border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Échéancier"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Échéance"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Montant"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Statut"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Facture"})]})}),e.jsxs("tbody",{children:[(s.payment_schedule||[]).map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:i(t.due_date)}),e.jsx("td",{className:"py-2 px-3",children:m(t.amount,d)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(p,{type:"schedule",state:t.state})}),e.jsx("td",{className:"py-2 px-3",children:t.invoice_id?e.jsx(y,{className:"underline",to:`/factures/${t.invoice_id}`,children:"Voir la facture"}):"—"})]},t.id)),(!s.payment_schedule||s.payment_schedule.length===0)&&e.jsx("tr",{children:e.jsx("td",{className:"py-3 px-3",colSpan:4,children:"Aucune échéance."})})]})]})})]}),e.jsxs("section",{className:"bg-white border rounded p-4",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Factures du contrat"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Code"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Émise le"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Échéance"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Montant"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Statut"}),e.jsx("th",{className:"text-right py-2 px-3",children:"Action"})]})}),e.jsxs("tbody",{children:[(s.invoices||[]).map(t=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3",children:t.code||t.name||`#${t.id}`}),e.jsx("td",{className:"py-2 px-3",children:i(t.issue_date)}),e.jsx("td",{className:"py-2 px-3",children:i(t.due_date)}),e.jsx("td",{className:"py-2 px-3",children:m(t.amount_total,t.currency||d)}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(p,{type:"invoice",state:t.status})}),e.jsx("td",{className:"py-2 px-3 text-right",children:e.jsx(y,{className:"px-3 py-1 bg-yellow-400 hover:bg-yellow-500 transition rounded",to:`/factures/${t.id}`,children:"Détails"})})]},t.id)),(!s.invoices||s.invoices.length===0)&&e.jsx("tr",{children:e.jsx("td",{className:"py-3 px-3",colSpan:6,children:"Aucune facture."})})]})]})})]})]})})]})})]})}export{F as default};
