import{u as p,j as e,S as f,L as N,P as b,g as v}from"./index.eWEbYf7N.js";import{b as l,L as j}from"./vendor.CrEiiG9O.js";const g=a=>a?new Date(a).toLocaleDateString("fr-FR"):"—",o=(a,t="XOF")=>new Intl.NumberFormat("fr-FR",{style:"currency",currency:t}).format(Number(a||0));function w({title:a,backTo:t}){return e.jsxs("div",{className:"bg-white border rounded p-6",children:[e.jsx("p",{className:"text-gray-600",children:a}),t&&e.jsx("div",{className:"mt-3",children:e.jsx(j,{to:t,className:"px-3 py-1 rounded bg-gray-100 hover:bg-gray-200",children:"← Retour"})})]})}function c({children:a,tone:t="gray"}){const r={gray:"bg-gray-100 text-gray-700",green:"bg-green-100 text-green-700",red:"bg-red-100 text-red-700",yellow:"bg-yellow-100 text-yellow-700",blue:"bg-blue-100 text-blue-700"};return e.jsx("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs font-medium ${r[t]||r.gray}`,children:a})}function m(a){const t=(a||"").toLowerCase();return["paid","success","completed","confirmé","réussi"].some(r=>t.includes(r))?"green":["pending","en attente","processing"].some(r=>t.includes(r))?"yellow":["failed","cancel","refused","rejected","échoué","annulé"].some(r=>t.includes(r))?"red":"gray"}function F(){const{user:a}=p(),[t,r]=l.useState([]),[n,x]=l.useState(!0),[u,d]=l.useState(""),h=async()=>{x(!0),d("");try{const s=await v.listByPartner(a?.id),i=Array.isArray(s?.payments)?s.payments:[];r(i),i.length||d("Aucun paiement trouvé.")}catch(s){console.error(s),r([]),d("Impossible de charger les paiements.")}finally{x(!1)}};l.useEffect(()=>{h()},[a?.id]);const y=l.useMemo(()=>t.filter(s=>m(s.status)==="green").reduce((s,i)=>s+Number(i.amount||0),0),[t]);return e.jsxs(e.Fragment,{children:[e.jsx(f,{title:"Touba Sandaga | Mes paiements",description:"Historique de paiements et factures — Touba Sandaga.",keywords:"paiement, facture, Touba Sandaga, historique"}),e.jsx(N,{childrenClasses:"pt-0 pb-0",children:e.jsxs("div",{className:"about-page-wrapper w-full",children:[e.jsx("div",{className:"title-area w-full",children:e.jsx(b,{title:"Mes paiements",breadcrumb:[{name:"Accueil",path:"/"},{name:"Profile",path:"/profile"},{name:"Paiements",path:"/paiements"}]})}),e.jsx("div",{className:"aboutus-wrapper w-full",children:e.jsx("div",{className:"container-x mx-auto",children:e.jsxs("div",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Historique"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(c,{tone:"blue",children:[t.length," enregistrements"]}),e.jsxs(c,{tone:"green",children:["Payé: ",o(y,t?.[0]?.currency||"XOF")]}),e.jsx("button",{onClick:h,className:"px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 text-sm",disabled:n,children:n?"Actualisation…":"Rafraîchir"}),e.jsx(j,{to:"/",className:"px-3 py-1 rounded bg-gray-100 hover:bg-gray-200 text-sm",children:"← Accueil"})]})]}),e.jsxs("section",{className:"bg-white p-4 border rounded",children:[n&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"h-4 w-40 bg-gray-100 animate-pulse rounded"}),e.jsx("div",{className:"h-8 w-full bg-gray-100 animate-pulse rounded"}),e.jsx("div",{className:"h-8 w-full bg-gray-100 animate-pulse rounded"}),e.jsx("div",{className:"h-8 w-full bg-gray-100 animate-pulse rounded"})]}),!n&&(!!u||t.length===0)&&e.jsx(w,{title:u||"Aucun paiement.",backTo:"/"}),!n&&t.length>0&&e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left py-2 px-3",children:"Facture"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Date"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Montant"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Méthode"}),e.jsx("th",{className:"text-left py-2 px-3",children:"Statut"})]})}),e.jsx("tbody",{children:t.map(s=>e.jsxs("tr",{className:"border-b",children:[e.jsx("td",{className:"py-2 px-3 font-medium",children:s.invoice_code||s.invoice_id||"—"}),e.jsx("td",{className:"py-2 px-3",children:g(s.paid_at||s.created_at)}),e.jsx("td",{className:"py-2 px-3",children:o(s.amount,s.currency||"XOF")}),e.jsx("td",{className:"py-2 px-3",children:s.method||"—"}),e.jsx("td",{className:"py-2 px-3",children:e.jsx(c,{tone:m(s.status),children:s.status||"—"})})]},s.id))})]})}),!n&&t.length>0&&e.jsx("div",{className:"md:hidden space-y-3",children:t.map(s=>e.jsxs("div",{className:"border rounded p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:s.invoice_code||s.invoice_id||"—"}),e.jsx(c,{tone:m(s.status),children:s.status||"—"})]}),e.jsxs("dl",{className:"mt-2 grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Date"}),e.jsx("dd",{className:"font-medium",children:g(s.paid_at||s.created_at)})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Montant"}),e.jsx("dd",{className:"font-medium",children:o(s.amount,s.currency||"XOF")})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Méthode"}),e.jsx("dd",{className:"font-medium",children:s.method||"—"})]}),e.jsxs("div",{children:[e.jsx("dt",{className:"text-gray-500",children:"Référence"}),e.jsx("dd",{className:"font-medium break-all",children:s.reference||"—"})]})]})]},s.id))})]})]})})})]})})]})}export{F as default};
