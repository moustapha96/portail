import{e as l,j as e,L as T,b as p,T as f,E as v,d as M,f as z}from"./index.eWEbYf7N.js";import{u as A,c as H,b as a,L as O}from"./vendor.CrEiiG9O.js";import{E as N}from"./eye-off.CRoTanUS.js";function V(){const r="#487a43",k="#3e6c3b",P=A(),b=new URLSearchParams(P.search),t=b.get("mail"),i=b.get("token"),E=H(),[w,g]=a.useState(!1),[c,L]=a.useState(""),[d,C]=a.useState(""),[o,y]=a.useState({password:"",confirmPassword:"",submit:""}),[m,S]=a.useState(!1),[u,R]=a.useState(!1),x=s=>s.currentTarget.style.boxShadow=`0 0 0 2px ${r}33`,h=s=>s.currentTarget.style.boxShadow="none",q=()=>{const s={password:c?"":"Le mot de passe est obligatoire.",confirmPassword:d?c!==d?"Les mots de passe ne correspondent pas.":"":"La confirmation est obligatoire.",submit:""};return y(s),Object.values(s).every(n=>!n)},B=async s=>{if(s.preventDefault(),!t||!i){l.error("Lien invalide : email ou token manquant.",{position:"top-center"});return}if(!q()){l.error("Formulaire invalide. Corrigez les erreurs puis réessayez.",{position:"top-center"});return}g(!0);try{const n={email:t,password:c,token:i};await z.newPassword(n),l.success("Mot de passe réinitialisé avec succès.",{position:"top-center",autoClose:4e3}),E("/login",{replace:!0})}catch(n){const j=n?.response?.data?.message||n?.response?.data||"Réinitialisation impossible. Le lien a peut-être expiré.";y(F=>({...F,submit:j})),l.error(String(j),{position:"top-center"})}finally{g(!1)}};return a.useEffect(()=>{(!t||!i)&&l.warn("Paramètres manquants dans l’URL.",{position:"top-center"}),window.scrollTo({top:0,behavior:"smooth"})},[t,i]),e.jsx(T,{children:e.jsx("div",{className:"w-full flex items-start justify-center px-4 py bg-gray-50",children:e.jsx("div",{className:"w-full max-w-md",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 border border-[#E0E0E0] dark:border-gray-700 rounded-lg shadow-md",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:"w-14 h-14 rounded-full mx-auto flex items-center justify-center shadow-sm",style:{backgroundColor:r},"aria-hidden":!0,children:e.jsx("svg",{viewBox:"0 0 24 24",className:"w-7 h-7 text-white",fill:"currentColor",children:e.jsx("path",{d:"M12 3l9 8h-3v8h-5v-5H11v5H6v-8H3l9-8z"})})}),e.jsx("h1",{className:"mt-3 text-2xl font-bold",style:{color:r},children:"Nouveau mot de passe"}),(!t||!i)&&e.jsx("p",{className:"mt-2 text-sm text-red-600",children:"Email ou token manquant — vérifiez votre lien."}),o.submit&&e.jsx("p",{className:"text-sm text-red-600 mt-3",children:o.submit})]}),e.jsxs("form",{onSubmit:B,className:"space-y-5",children:[t&&e.jsxs("div",{children:[e.jsx(p,{htmlFor:"email",className:"mb-2 block text-sm font-medium",children:"Email"}),e.jsx(f,{id:"email",value:t,readOnly:!0,onFocus:x,onBlur:h,theme:{field:{input:{base:"block w-full border bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-white"}}}})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"password",className:"mb-2 block text-sm font-medium",children:"Nouveau mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{id:"password",type:m?"text":"password",value:c,onChange:s=>L(s.target.value),placeholder:"••••••••",required:!0,className:"pr-10",onFocus:x,onBlur:h,theme:{field:{input:{base:"block w-full border bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}}}}),e.jsx("button",{type:"button",onClick:()=>S(s=>!s),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 dark:text-gray-300","aria-label":m?"Masquer":"Afficher",children:m?e.jsx(N,{className:"h-5 w-5"}):e.jsx(v,{className:"h-5 w-5"})})]}),o.password&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o.password})]}),e.jsxs("div",{children:[e.jsx(p,{htmlFor:"confirmPassword",className:"mb-2 block text-sm font-medium",children:"Confirmer le mot de passe"}),e.jsxs("div",{className:"relative",children:[e.jsx(f,{id:"confirmPassword",type:u?"text":"password",value:d,onChange:s=>C(s.target.value),placeholder:"••••••••",required:!0,className:"pr-10",onFocus:x,onBlur:h,theme:{field:{input:{base:"block w-full border bg-white dark:bg-gray-700 text-gray-900 dark:text-white"}}}}),e.jsx("button",{type:"button",onClick:()=>R(s=>!s),className:"absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 dark:text-gray-300","aria-label":u?"Masquer":"Afficher",children:u?e.jsx(N,{className:"h-5 w-5"}):e.jsx(v,{className:"h-5 w-5"})})]}),o.confirmPassword&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:o.confirmPassword})]}),e.jsx("button",{type:"submit",disabled:w,className:"w-full flex items-center justify-center text-white font-medium py-2.5 px-4 rounded-md focus:outline-none transition disabled:opacity-60",style:{backgroundColor:r},onMouseEnter:s=>s.currentTarget.style.backgroundColor=k,onMouseLeave:s=>s.currentTarget.style.backgroundColor=r,children:w?e.jsxs("span",{className:"inline-flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 animate-spin"}),"Enregistrement…"]}):"Enregistrer"}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:["Vous vous souvenez de votre mot de passe ?",e.jsx(O,{to:"/login",className:"ml-1 underline",style:{color:r},children:"Se connecter"})]})})]})]})})})})}export{V as default};
